## This doc describes how setup content mirrors for disconnected installs

#### # You must first sync the development rpm repos from the internal build servers
###### # make sure you have ample space available on your local repo box (called repo.home.nicknach.net in my lab).  
###### # You need at least 30GB total.  (~10GB  for rpms and ~20GB for images)

##### # subscribe your repo box to the proper channels for OCP
```
subscription-manager register --username=nnachefs@redhat.com --password <REDACTED> --force
subscription-manager attach --pool=8a85f98260c27fc50160c323263339ff
subscription-manager repos --disable="*"
subscription-manager repos \
   --enable=rhel-7-server-rpms \
   --enable=rhel-7-server-extras-rpms \
   --enable=rhel-7-server-ose-3.7-rpms \
   --enable=rhel-7-fast-datapath-rpms \
   --enable=rhel-7-server-rhscl-rpms \
   --enable=rhel-7-server-optional-rpms 
#   --enable=rh-gluster-3-for-rhel-7-server-rpms \ 
#   --enable=rhel-7-server-3scale-amp-2.0-rpms
```
##### # start the reposync
wget 
##### # create the repodata xml
```
createrepo rhaos-3.9
```
##### # install/enable/start httpd
```
yum -y install httpd && systemctl enable httpd --now
```
##### # add a link to your repo dir in the web root
```
ln -s /root/rhaos-3.9 /var/www/html/rhaos-3.9 
```
##### # fix selinux
``` 
restorecon -R /var/www/html/rhaos-3.9
```
#### # now lets create the docker image mirror on our repo server
##### # install/enable/start docker-distribution on the repo box
```
yum -y install docker-distribution.x86_64 && systemctl enable docker-distribution --now
```
##### # open the firewall up
```
firewall-cmd --set-default-zone trusted
```
##### # now run the import-image.py script
```
cd ~ && wget https://raw.githubusercontent.com/nnachefski/ocpstuff/master/images/import-images.py && wget https://raw.githubusercontent.com/nnachefski/ocpstuff/master/images/images.txt
chmod +x import-images.py
./import-images.py docker brew-pulp-docker01.web.prod.ext.phx2.redhat.com:8888 repo.home.nicknach.net:5000 -t v3.9.0 -d
```